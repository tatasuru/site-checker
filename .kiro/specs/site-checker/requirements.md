# 要件定義書

## 概要

サイトチェッカーは、ウェブサイトの自動クローリング、サイトマップ作成、SEO 分析機能を備えたフルスタック Web アプリケーションです。ユーザーはクローリング対象のウェブサイトを登録し、リアルタイムでクローリング進捗を監視し、インタラクティブなダッシュボードでサイト構造を可視化できます。

## 要件

### 要件 1

**ユーザーストーリー:** ウェブサイト所有者として、自動クローリングのためにウェブサイトを登録したい。そうすることで、サイト構造を分析し、問題を特定できる。

#### 受入基準

1. ユーザーがプロジェクト作成ページにアクセスした時、システムは多段階の登録フォームを表示する
2. ユーザーが有効なウェブサイト URL を入力した時、システムは URL 形式とアクセス可能性を検証する
3. ユーザーがクローリングパラメータ（最大ページ数、深度）を指定した時、システムはこれらの設定を受け入れて保存する
4. プロジェクトが作成された時、システムはデータベースに新しいプロジェクトレコードを作成する
5. プロジェクトが作成された時、システムはユーザーをプロジェクトダッシュボードにリダイレクトする

### 要件 2

**ユーザーストーリー:** ユーザーとして、Google アカウントを使用して安全に認証したい。そうすることで、プロジェクトとデータが保護される。

#### 受入基準

1. ユーザーがアプリケーションにアクセスした時、システムは Google OAuth 認証を提供する
2. ユーザーが正常に認証された時、システムはデータベースでプロファイルを作成または更新する
3. 未認証ユーザーが保護されたページにアクセスしようとした時、システムはログインページにリダイレクトする
4. ユーザーがログアウトした時、システムはセッションをクリアしてログインページにリダイレクトする
5. ユーザーのセッションが期限切れになった時、システムは再認証を要求する

### 要件 3

**ユーザーストーリー:** ユーザーとして、クローリングの進捗をリアルタイムで監視したい。そうすることで、ウェブサイト分析の状況を追跡できる。

#### 受入基準

1. クローリングジョブが開始された時、システムはリアルタイムの進捗更新を表示する
2. クローリングが進行中の時、システムは処理済みページ数と残りページ数を表示する
3. クローリングでエラーが発生した時、システムはエラーメッセージを表示し、処理を継続する
4. クローリングが完了した時、システムはジョブステータスを完了に更新する
5. 複数のクローリングジョブが実行中の時、システムは最大 1 つの同時ジョブで並行処理を管理する

### 要件 4

**ユーザーストーリー:** ユーザーとして、インタラクティブなサイトマップを通じてウェブサイト構造を可視化したい。そうすることで、ページ間の関係を理解できる。

#### 受入基準

1. クローリングが完了した時、システムは Vue Flow 用の可視化データを生成する
2. ユーザーがプロジェクト詳細を表示した時、システムはインタラクティブなサイトマップを表示する
3. ユーザーがサイトマップのノードと相互作用した時、システムはページ詳細と関係を表示する
4. サイトマップが表示された時、システムは親子関係を持つ階層構造を表示する
5. ユーザーがサイトマップをナビゲートした時、システムはズーム、パン、ノード選択機能を提供する

### 要件 5

**ユーザーストーリー:** ユーザーとして、クローリングされたページの自動 SEO 分析を受けたい。そうすることで、最適化の機会を特定できる。

#### 受入基準

1. クローリングジョブが完了した時、システムは自動的に SEO 分析をトリガーする
2. SEO 分析が実行された時、システムはメタタグ、見出し、ページ構造を検査する
3. SEO 分析が完了した時、システムはクローリングデータにリンクされた結果を保存する
4. SEO の問題が検出された時、システムは重要度とタイプで分類する
5. ユーザーが SEO 結果を表示した時、システムは実行可能な推奨事項を表示する

### 要件 6

**ユーザーストーリー:** ユーザーとして、複数のウェブサイトプロジェクトを管理したい。そうすることで、異なるサイトを個別に整理し追跡できる。

#### 受入基準

1. ユーザーがプロジェクトページにアクセスした時、システムは登録されたすべてのプロジェクトを表示する
2. ユーザーが新しいプロジェクトを作成した時、システムはプロジェクトリストに追加する
3. ユーザーがプロジェクトを表示した時、システムは最新のクローリング結果とステータスを表示する
4. ユーザーがプロジェクトを削除した時、システムは関連するすべてのデータを削除する
5. プロジェクトがリストされた時、システムは作成日、最終クローリング日、ステータスを表示する

### 要件 7

**ユーザーストーリー:** システム管理者として、クローラーがウェブサイトのポリシーと制限を尊重することを望む。そうすることで、対象サーバーに過負荷をかけない。

#### 受入基準

1. クローリングが開始された時、システムは robots.txt の指示を尊重する
2. リクエストを行う時、システムはサーバー過負荷を防ぐためのレート制限を実装する
3. エラーが発生した時、システムは指数バックオフによるリトライロジックを実装する
4. 大規模サイトをクローリングする時、システムは同時リクエストを最大 10 に制限する
5. クローリングジョブが指定されたページ制限を超えた時、システムは処理を停止し完了としてマークする

### 要件 8

**ユーザーストーリー:** ユーザーとして、クローリングされたコンテンツを検索したい。そうすることで、ウェブサイト全体で特定の情報を見つけることができる。

#### 受入基準

1. クローリングデータが利用可能な時、システムは全文検索機能を提供する
2. ユーザーが検索語を入力した時、システムはページコンテンツ、タイトル、メタ説明を検索する
3. 検索結果が表示された時、システムは一致する語をハイライトし、コンテキストを表示する
4. 検索が実行された時、システムは単純テキストと正規表現パターンの両方をサポートする
5. 結果が見つからない時、システムは適切なメッセージを表示する

### 要件 9

**ユーザーストーリー:** ユーザーとして、クローリング結果とレポートをエクスポートしたい。そうすることで、チームと発見事項を共有したり、他のツールで使用したりできる。

#### 受入基準

1. クローリング結果が利用可能な時、システムはエクスポート機能を提供する
2. データをエクスポートする時、システムは検索エンジン向けの XML サイトマップ形式をサポートする
3. データをエクスポートする時、システムは人間向けの HTML サイトマップ形式をサポートする
4. レポートをエクスポートする時、システムは SEO 分析結果と推奨事項を含める
5. エクスポートが要求された時、システムは指定された形式でダウンロード可能なファイルを生成する

### 要件 10

**ユーザーストーリー:** システム管理者として、クローリング完了時に自動的に SEO 分析が開始されることを望む。そうすることで、ユーザーが手動で操作することなく、シームレスなワークフローを提供できる。

#### 受入基準

1. クローリングジョブが完了した時、システムは`crawl_results`テーブルのステータスを`completed`に更新する
2. `crawl_results`のステータスが`completed`になった時、システムは SEO チェッカーバックエンドに内部 Webhook 通知を送信する
3. 内部 Webhook 通知が送信された時、システムはクローリング結果 ID、プロジェクト ID、ユーザー ID を含める
4. SEO チェッカーバックエンドが Webhook 通知を受信した時、システムは自動的に SEO 分析ジョブを作成する
5. 内部 Webhook 配信が失敗した時、システムは指数バックオフによるリトライロジックを実装する
