# サイトチェッカー要件仕様書

## 概要

Web サイトの品質管理と運用支援を目的としたサイトチェッカーツールの要件定義

## 主要機能

### 1. サイトクロール機能

- **URL 収集**: 指定したドメイン・サブドメインの全ページを自動収集
- **クロール深度設定**: 最大クロール階層の指定
- **クロール範囲制御**:
  - 除外パス・ファイルタイプの設定
  - robots.txt 準拠オプション
- **クロール履歴管理**:
  - 実行日時、取得ページ数の記録
  - 前回クロール結果との差分表示
- **レスポンシブ対応**: PC・モバイル両方でのページ取得

### 2. 品質チェック機能

#### 2.1 リンク切れチェック

- **内部リンク**: サイト内リンクの有効性確認
- **外部リンク**: 外部サイトへのリンク状態確認
- **アンカーリンク**: ページ内アンカーの存在確認
- **結果出力**: エラーページとリンク元の一覧表示

#### 2.2 SEO 品質チェック

- **メタタグ検証**: title、description、keywords の存在・文字数
- **見出し構造**: h1〜h6 の階層構造確認
- **画像 alt 属性**: 画像の alt 属性設定確認
- **ページ表示速度**: 読み込み時間測定

#### 2.3 アクセシビリティチェック

- **コントラスト比**: 文字色と背景色の視認性
- **フォーカス管理**: キーボードナビゲーション確認
- **ARIA 属性**: 適切な ARIA ラベル設定確認

#### 2.4 技術的品質チェック

- **HTTP ステータス**: 各ページのレスポンスコード確認
- **SSL 証明書**: HTTPS 接続の有効性
- **モバイル対応**: レスポンシブデザイン確認
- **重複コンテンツ**: 同一・類似コンテンツの検出

### 3. コンテンツ検索機能

- **全文検索**: クロール済みページ内のキーワード検索
- **正規表現検索**: パターンマッチング検索
- **メタデータ検索**: title、description、headings 内の検索
- **検索結果出力**: 該当ページ URL、マッチ箇所のハイライト表示

### 4. サイトマップ出力機能

- **XML Sitemap**: 検索エンジン向けサイトマップ生成
- **HTML Sitemap**: 人間向けサイトマップページ生成
- **階層表示**: サイト構造の視覚的な表示
- **フィルタリング**: 特定条件でのページ除外設定

### 5. レポート・分析機能

- **総合レポート**: 全チェック結果の統合表示
- **時系列分析**: 過去のチェック結果との比較
- **優先度設定**: エラー・警告の重要度分類
- **改善提案**: 検出された問題の修正方法提示

## 技術要件

### システム構成

- **フロントエンド**: Nuxt.js (Vue.js 3 + TypeScript)
- **バックエンド**: Node.js (TypeScript) + Crawlee
- **データベース**: Supabase (PostgreSQL)（クロール履歴・結果保存）
- **Web サーバー**: Nginx（リバースプロキシ）

### Crawlee 活用による機能

- **ブラウザクロール**: Playwright/Puppeteer による動的コンテンツ対応
- **スケーラブルクロール**: 分散処理とキューイング機能
- **リクエスト管理**: レート制限・リトライ・キャッシュの自動制御
- **データ抽出**: 構造化されたデータ収集とパイプライン処理

### パフォーマンス要件

- **並列クロール**: Crawlee のワーカープール活用による効率的な並列処理
- **メモリ管理**: 大規模サイト対応のためのストリーミング処理
- **レート制限**: サイト負荷を考慮した自動調整機能
- **セッション管理**: ログイン必要サイトへの対応
- **プロキシローテーション**: IP 制限回避のためのプロキシ対応

### セキュリティ要件

- **認証機能**: ユーザー管理・アクセス制御
- **ログ管理**: アクセス・操作履歴の記録
- **データ暗号化**: 保存データの暗号化対応

## アーキテクチャ設計

### フロントエンド（Nuxt.js）

- **SSR/SPA**: サーバーサイドレンダリングとクライアントサイドルーティング
- **TypeScript**: 型安全性とメンテナビリティの向上
- **Composition API**: Vue 3 の最新機能活用
- **状態管理**: Pinia 使用によるリアクティブな状態管理
- **UI Components**: PrimeVue/Vuetify 等の UI ライブラリ活用

### バックエンド（Node.js + Crawlee）

- **RESTful API**: Express.js/Fastify ベースの API 設計
- **WebSocket**: リアルタイムクロール進捗通知
- **ジョブキュー**: Bullqueue によるバックグラウンド処理
- **Supabase Client**: @supabase/supabase-js による統合
- **ログ機能**: Winston/Pino による構造化ログ出力

### データベース設計（Supabase）

- **リアルタイム機能**: クロール進捗のリアルタイム更新
- **JSONB 型活用**: 柔軟なクロール結果・エラー詳細保存
- **フルテキスト検索**: PostgreSQL の全文検索機能活用
- **RLS（Row Level Security）**: マルチサイト・マルチユーザー対応
- **Cron Jobs**: pg_cron による定期実行機能

## ユーザーインターフェース

### Nuxt によるモダンなフロントエンド

### ダッシュボード

- サイト登録・管理画面
- 最新チェック結果のサマリー表示
- 過去の実行履歴一覧

### 詳細結果画面

- チェック項目別の詳細結果
- エラー・警告の一覧とフィルタリング
- 修正済みマーク機能

### 設定画面

- クロール条件の詳細設定
- チェック項目の有効/無効切り替え
- 通知設定（メール・Slack 等）

## 運用要件

### スケジュール実行

- **定期実行**: 日次・週次・月次の自動実行
- **差分チェック**: 前回実行との差分のみをチェック
- **アラート機能**: 新たなエラー検出時の通知

### データ管理

- **履歴保持期間**: 過去データの保存期間設定
- **エクスポート機能**: CSV・PDF 形式でのレポート出力
- **バックアップ**: データベースの定期バックアップ

## 拡張性

### プラグイン対応

- カスタムチェック項目の追加
- 外部ツール連携（GA、GSC 等）
- API 提供による他システム連携

### マルチサイト対応

- 複数サイトの一括管理
- サイト間の比較分析
- テナント管理機能

## 案

みたい項目に分けて掲載するのがいいかも知れない。
終わった結果からどんどん出す。
AI 向けの SEO チェック
playwright mcp を使ってプロンプトベースで user に使ってもらう。
校正ツールとのコラボ。
メインコンテンツの判断。
